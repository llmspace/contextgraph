# M03-F16: Module Structure and Exports

```xml
<task_spec id="M03-F16" version="1.0">
<metadata>
  <title>Create Module Structure and Public Exports</title>
  <status>ready</status>
  <layer>foundation</layer>
  <sequence>16</sequence>
  <implements>PRD Section 4.3, Rust module conventions</implements>
  <depends_on>M03-F01, M03-F02, M03-F03, M03-F04, M03-F05, M03-F06, M03-F07, M03-F08, M03-F09, M03-F10, M03-F11, M03-F12, M03-F13, M03-F14, M03-F15</depends_on>
  <estimated_hours>2</estimated_hours>
</metadata>

<context>
Create the crate module structure with proper exports for the context-graph-embeddings crate.
This task organizes all Foundation layer types into a clean public API.

The crate provides:
- 12-model embedding pipeline
- FuseMoE fusion to 1536D
- Batch processing
- Caching
- GPU acceleration support
</context>

<definition_of_done>
  <signatures>
```rust
// crates/context-graph-embeddings/src/lib.rs

//! 12-Model Embedding Pipeline for Context Graph.
//!
//! Provides text-to-embedding conversion using 12 specialized models
//! fused via FuseMoE into unified 1536D representations.
//!
//! # Architecture
//!
//! ```text
//! Input Text/Code/Image
//!         |
//!         v
//! [12 Embedding Models] --> 12 vectors (various dimensions)
//!         |
//!         v
//!   [Concatenation] --> 8320D
//!         |
//!         v
//!    [FuseMoE] --> 1536D unified embedding
//!         |
//!         v
//!     [Cache] --> Store for future retrieval
//! ```
//!
//! # Quick Start
//!
//! ```rust,ignore
//! use context_graph_embeddings::{EmbeddingPipeline, EmbeddingConfig};
//!
//! let config = EmbeddingConfig::default();
//! let pipeline = EmbeddingPipeline::new(config).await?;
//! pipeline.initialize().await?;
//!
//! let embedding = pipeline.embed("Hello, world!").await?;
//! assert_eq!(embedding.vector.len(), 1536);
//! ```
//!
//! # Features
//!
//! - 12 specialized embedding models (semantic, temporal, causal, etc.)
//! - FuseMoE Mixture of Experts fusion
//! - Dynamic batching for high throughput (>100 items/sec)
//! - LRU cache with >80% hit rate
//! - GPU acceleration via CUDA
//!
//! # Modules
//!
//! - [`config`] - Configuration types
//! - [`error`] - Error types and Result alias
//! - [`types`] - Core types (ModelId, embeddings, inputs)
//! - [`traits`] - Core traits (EmbeddingModel, ModelFactory)
//! - [`models`] - Model implementations (pretrained and custom)
//! - [`batch`] - Batch processing
//! - [`cache`] - Embedding cache
//! - [`fusion`] - FuseMoE fusion layer
//! - [`pipeline`] - Main pipeline orchestration

pub mod config;
pub mod error;
pub mod types;
pub mod traits;
pub mod models;
pub mod batch;
pub mod cache;
pub mod fusion;
pub mod pipeline;

// ============================================================================
// Re-exports for convenient access
// ============================================================================

// Configuration
pub use config::EmbeddingConfig;

// Errors
pub use error::{EmbeddingError, EmbeddingResult};

// Core types
pub use types::{
    ModelId,
    ModelEmbedding,
    ConcatenatedEmbedding,
    FusedEmbedding,
    ModelInput,
    InputType,
    ImageFormat,
};

// Dimension constants
pub use types::dimensions;

// Traits
pub use traits::{EmbeddingModel, ModelFactory};

// Pipeline (main entry point)
pub use pipeline::EmbeddingPipeline;

// ============================================================================
// Crate-level constants
// ============================================================================

/// Default fused embedding dimension (1536D).
pub const DEFAULT_DIMENSION: usize = 1536;

/// Number of embedding models in the pipeline.
pub const NUM_MODELS: usize = 12;

/// Number of FuseMoE experts.
pub const NUM_EXPERTS: usize = 8;
```

```rust
// crates/context-graph-embeddings/src/types/mod.rs

//! Core types for the embedding pipeline.

pub mod model_id;
pub mod embedding;
pub mod fused;
pub mod input;

pub use model_id::{ModelId, dimensions};
pub use embedding::{ModelEmbedding, ConcatenatedEmbedding};
pub use fused::FusedEmbedding;
pub use input::{ModelInput, InputType, ImageFormat};
```

```rust
// crates/context-graph-embeddings/src/traits/mod.rs

//! Core traits for embedding models and factories.

pub mod embedding_model;
pub mod model_factory;

pub use embedding_model::EmbeddingModel;
pub use model_factory::ModelFactory;
```

```rust
// crates/context-graph-embeddings/src/models/mod.rs

//! Embedding model implementations.

pub mod registry;
pub mod memory;
pub mod factory;

pub mod pretrained {
    //! Pretrained transformer models.
    pub mod semantic;
    pub mod causal;
    pub mod sparse;
    pub mod code;
    pub mod graph;
    pub mod multimodal;
    pub mod entity;
    pub mod late_interaction;
}

pub mod custom {
    //! Custom computed models.
    pub mod temporal_recent;
    pub mod temporal_periodic;
    pub mod temporal_positional;
    pub mod hdc;
}

pub use registry::ModelRegistry;
pub use factory::DefaultModelFactory;
```

```rust
// crates/context-graph-embeddings/src/batch/mod.rs

//! Batch processing for high-throughput embedding.

pub mod types;
pub mod processor;

pub use types::{BatchRequest, BatchQueue};
pub use processor::BatchProcessor;
```

```rust
// crates/context-graph-embeddings/src/cache/mod.rs

//! Embedding cache for avoiding recomputation.

pub mod types;
pub mod manager;

pub use types::{CacheKey, CacheEntry};
pub use manager::CacheManager;
```

```rust
// crates/context-graph-embeddings/src/fusion/mod.rs

//! FuseMoE Mixture of Experts fusion layer.

pub mod gating;
pub mod experts;
pub mod router;
pub mod fusemoe;

pub use gating::GatingNetwork;
pub use experts::{Expert, ExpertPool};
pub use router::Router;
pub use fusemoe::FuseMoE;
```

```rust
// crates/context-graph-embeddings/src/pipeline/mod.rs

//! Main embedding pipeline orchestration.

mod core;
mod metrics;

pub use core::EmbeddingPipeline;
pub use metrics::{PipelineMetrics, HealthStatus};
```
  </signatures>

  <constraints>
    - All public types re-exported from lib.rs
    - cargo doc generates clean documentation (no broken links)
    - No compiler warnings
    - Rustdoc examples compile (ignore for now if pipeline not ready)
    - Follow standard Rust module organization
    - Use //! for module-level docs
    - Use /// for item-level docs
  </constraints>

  <verification>
    - cargo check --package context-graph-embeddings passes
    - cargo doc --package context-graph-embeddings --no-deps passes
    - All re-exports accessible from crate root
    - DEFAULT_DIMENSION = 1536
    - NUM_MODELS = 12
    - NUM_EXPERTS = 8
  </verification>
</definition_of_done>

<files_to_create>
  <file>crates/context-graph-embeddings/src/lib.rs</file>
  <file>crates/context-graph-embeddings/src/types/mod.rs</file>
  <file>crates/context-graph-embeddings/src/traits/mod.rs</file>
  <file>crates/context-graph-embeddings/src/models/mod.rs</file>
  <file>crates/context-graph-embeddings/src/batch/mod.rs</file>
  <file>crates/context-graph-embeddings/src/cache/mod.rs</file>
  <file>crates/context-graph-embeddings/src/fusion/mod.rs</file>
  <file>crates/context-graph-embeddings/src/pipeline/mod.rs</file>
</files_to_create>

<validation_criteria>
  <criterion>cargo check --package context-graph-embeddings passes</criterion>
  <criterion>cargo doc --package context-graph-embeddings --no-deps passes</criterion>
  <criterion>cargo clippy --package context-graph-embeddings -- -D warnings shows 0 warnings</criterion>
  <criterion>All Foundation layer types accessible via crate root</criterion>
</validation_criteria>
</task_spec>
```

---

## Implementation Notes

### Directory Structure
```
crates/context-graph-embeddings/
  Cargo.toml
  src/
    lib.rs              # Crate root with re-exports
    config.rs           # EmbeddingConfig and sub-configs
    error.rs            # EmbeddingError and EmbeddingResult
    types/
      mod.rs            # types module
      model_id.rs       # ModelId enum and dimensions
      embedding.rs      # ModelEmbedding, ConcatenatedEmbedding
      fused.rs          # FusedEmbedding
      input.rs          # ModelInput, InputType, ImageFormat
    traits/
      mod.rs            # traits module
      embedding_model.rs # EmbeddingModel trait
      model_factory.rs  # ModelFactory trait
    models/
      mod.rs            # models module
      registry.rs       # ModelRegistry
      memory.rs         # MemoryTracker
      factory.rs        # DefaultModelFactory
      pretrained/       # Pretrained model implementations
      custom/           # Custom model implementations
    batch/
      mod.rs            # batch module
      types.rs          # BatchRequest, BatchQueue
      processor.rs      # BatchProcessor
    cache/
      mod.rs            # cache module
      types.rs          # CacheKey, CacheEntry
      manager.rs        # CacheManager
    fusion/
      mod.rs            # fusion module
      gating.rs         # GatingNetwork
      experts.rs        # Expert, ExpertPool
      router.rs         # Router
      fusemoe.rs        # FuseMoE
    pipeline/
      mod.rs            # pipeline module
      core.rs           # EmbeddingPipeline (M03-S01)
      metrics.rs        # PipelineMetrics, HealthStatus
```

### Cargo.toml Dependencies
```toml
[package]
name = "context-graph-embeddings"
version = "0.1.0"
edition = "2021"

[dependencies]
# Async runtime
tokio = { version = "1.0", features = ["full"] }
async-trait = "0.1"

# Serialization
serde = { version = "1.0", features = ["derive"] }
serde_json = "1.0"
toml = "0.8"

# Time
chrono = { version = "0.4", features = ["serde"] }

# UUID
uuid = { version = "1.0", features = ["v4", "serde"] }

# Error handling
thiserror = "1.0"

# Data structures
hashbrown = "0.14"

# Hashing
ahash = "0.8"

# Workspace
context-graph-core = { path = "../context-graph-core" }
```

### Test Cases
1. `test_lib_constants` - DEFAULT_DIMENSION, NUM_MODELS, NUM_EXPERTS
2. `test_reexports_accessible` - All types importable from crate root
3. `test_doc_generation` - cargo doc succeeds

---

*Task ID: M03-F16*
*Module: 03 - 12-Model Embedding Pipeline*
*Layer: Foundation*
*Created: 2026-01-01*
