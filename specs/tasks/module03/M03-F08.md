# Task Specification: M03-F08

```xml
<task_spec id="M03-F08" version="1.0">
<metadata>
  <title>Extend EmbeddingError Enum with All Error Variants</title>
  <status>ready</status>
  <layer>foundation</layer>
  <sequence>8</sequence>
  <implements>constitution.yaml: embeddings.error_handling</implements>
  <depends_on>none</depends_on>
  <estimated_hours>2</estimated_hours>
</metadata>

<context>
Extend existing EmbeddingError with comprehensive error variants for all failure modes.
This error enum must cover all possible failure scenarios in the embedding pipeline:
- Model loading and initialization failures
- Input validation errors
- Dimension mismatches
- GPU/CUDA errors
- Cache errors
- Timeout errors
- Tokenization errors
- Fusion errors

Each variant should include contextual information to aid debugging.
</context>

<definition_of_done>
  <signatures>
```rust
use thiserror::Error;

#[derive(Debug, Error)]
pub enum EmbeddingError {
    #[error("Model not found: {model_id:?}")]
    ModelNotFound { model_id: ModelId },

    #[error("Model load failed for {model_id:?}: {source}")]
    ModelLoadError { model_id: ModelId, source: Box<dyn std::error::Error + Send + Sync> },

    #[error("Invalid dimension: expected {expected}, got {actual}")]
    InvalidDimension { expected: usize, actual: usize },

    #[error("Invalid embedding value at index {index}: {value}")]
    InvalidValue { index: usize, value: f32 },

    #[error("Input too long: {actual} tokens exceeds max {max}")]
    InputTooLong { actual: usize, max: usize },

    #[error("Empty input not allowed")]
    EmptyInput,

    #[error("Batch processing error: {message}")]
    BatchError { message: String },

    #[error("Fusion error: {message}")]
    FusionError { message: String },

    #[error("Cache error: {message}")]
    CacheError { message: String },

    #[error("GPU error: {message}")]
    GpuError { message: String },

    #[error("Tokenization error: {message}")]
    TokenizationError { message: String },

    #[error("IO error: {0}")]
    IoError(#[from] std::io::Error),

    #[error("Serialization error: {message}")]
    SerializationError { message: String },

    #[error("Operation timeout after {timeout_ms}ms")]
    Timeout { timeout_ms: u64 },

    #[error("Model not initialized: {model_id:?}")]
    NotInitialized { model_id: ModelId },

    #[error("Unsupported input type {input_type:?} for model {model_id:?}")]
    UnsupportedModality { model_id: ModelId, input_type: InputType },

    #[error("Configuration error: {message}")]
    ConfigError { message: String },
}

pub type EmbeddingResult<T> = Result<T, EmbeddingError>;
```
  </signatures>

  <constraints>
    <constraint>Use thiserror crate for derivation</constraint>
    <constraint>All variants must include contextual information</constraint>
    <constraint>EmbeddingResult<T> type alias must be defined</constraint>
    <constraint>Error must be Send + Sync for async compatibility</constraint>
    <constraint>IoError must have From implementation via #[from]</constraint>
  </constraints>

  <verification>
    <check>All variants compile correctly</check>
    <check>Error messages are descriptive and include context</check>
    <check>EmbeddingResult alias works correctly</check>
    <check>From<std::io::Error> works via ? operator</check>
    <check>Error is Send + Sync</check>
    <check>Debug formatting works</check>
    <check>Display formatting produces user-friendly messages</check>
  </verification>
</definition_of_done>

<files_to_create>
  <file>crates/context-graph-embeddings/src/error.rs</file>
</files_to_create>

<validation_criteria>
  <criterion>cargo check passes</criterion>
  <criterion>cargo test passes</criterion>
  <criterion>thiserror derive compiles without warnings</criterion>
  <criterion>All error variants are documented</criterion>
</validation_criteria>

<error_categories>
| Category | Variants | Recovery |
|----------|----------|----------|
| Model | ModelNotFound, ModelLoadError, NotInitialized | Retry with different config |
| Validation | InvalidDimension, InvalidValue, EmptyInput, InputTooLong | Fix input |
| Processing | BatchError, FusionError, TokenizationError | Retry or fallback |
| Infrastructure | GpuError, CacheError, IoError, Timeout | Retry or degrade |
| Configuration | ConfigError, UnsupportedModality | Fix config |
| Serialization | SerializationError | Fix data format |
</error_categories>

<usage_examples>
```rust
// Creating errors
let err = EmbeddingError::InvalidDimension { expected: 1536, actual: 768 };
let err = EmbeddingError::ModelNotFound { model_id: ModelId::Semantic };
let err = EmbeddingError::Timeout { timeout_ms: 5000 };

// Using Result alias
fn embed(text: &str) -> EmbeddingResult<FusedEmbedding> {
    if text.is_empty() {
        return Err(EmbeddingError::EmptyInput);
    }
    // ...
}

// Converting from io::Error
fn load_model(path: &Path) -> EmbeddingResult<Model> {
    let data = std::fs::read(path)?; // Auto-converts via From
    // ...
}
```
</usage_examples>
</task_spec>
```
